#!/bin/sh


# pipe the dmenu
Choice=$(printf '%s\n' "ğŸ”search" "ğŸ”§toolBar" "ğŸ“’readingList" "ğŸƒntuBookMark" "ğŸpythonResources" "ğŸ«juliaResources" "ğŸ“‰econData" | rofi -dmenu -p "BookMark ğŸ“¡:")

# create the function to get the bookmark
get_BookMark() {
    db=$1
    echo "$db"
    readarray -t dbList < $db  # create the array
    # split the name and the link
    name=$(printf '%s\n' "${dbList[@]}" | awk '{print $1}')
    url=$(printf '%s\n' "${dbList[@]}" | awk '{print $2}')
    declare -a name=($name)
    declare -a url=($url)
    choice=$(printf '%s\n' "${name[@]}" | rofi -dmenu -p "BookMarkğŸ“¡:")
    n=${#name[*]}  # nmber of the element
    for ((i=0; i<$n; i++)); do
        if [ "${name[$i]}" == "$choice" ]; then
            index=$i
            break
        fi
    done
    mode=$(echo -e "ğŸŒ—tab\nğŸŒ•window" | rofi -dmenu -p "choose the modeğŸŒ› ")
    if [ $mode == "ğŸŒ•window" ]; then
        $BROWSER "-new-window" "${url[$index]}"
    else
        $BROWSER "-new-tab" "${url[$index]}"
    fi
}

# reading-list or bookmar
if [ "$Choice" == "ğŸ”search" ]; then
    pick=$(echo -e "d: duckduckgo\ngh: github\nyt: youtube\ndic: cambridge dictionary\naw: arch wiki\npac: pacman\naur: AUR\nwk: wiki" | rofi -dmenu -p "search ğŸ”:")

    IFS=\  read -ra arr <<< $pick
    engine=${arr[0]}
    word=""
    for w in ${arr[@]}; do
        [ $w != $engine ] && word+=" $w"
    done

    mode=$(echo -e "ğŸŒ—tab\nğŸŒ•window" | rofi -dmenu -p "choose the modeğŸŒ› ")
    case $engine in
        "d")
            if [ $mode == "ğŸŒ•window" ]; then
                $BROWSER "-new-window" "https://start.duckduckgo.com/?q=$word"
            else
                $BROWSER "-new-tab" "https://start.duckduckgo.com/?q=$word"
            fi ;;
        "gh")
            if [ $mode == "ğŸŒ•window" ]; then
                $BROWSER "-new-window" "https://github.com/search?q=$word"
            else
                $BROWSER "-new-tab" "https://github.com/search?q=$word"
            fi ;;
        "yt")
            if [ $mode == "ğŸŒ•window" ]; then
                $BROWSER "-new-window" "https://www.youtube.com/results?search_query=$word"
            else
                $BROWSER "-new-tab" "https://www.youtube.com/results?search_query=$word"
            fi ;;
        "dic")
            if [ $mode == "ğŸŒ•window" ]; then
                $BROWSER "-new-window" "https://dictionary.cambridge.org/dictionary/english/$word"
            else
                $BROWSER "-new-tab" "https://dictionary.cambridge.org/dictionary/english/$word"
            fi ;;
        "aw")
            if [ $mode == "ğŸŒ•window" ]; then
                $BROWSER "-new-window" "https://wiki.archlinux.org/index.php?search=$word"
            else
                $BROWSER "-new-tab" "https://wiki.archlinux.org/index.php?search=$word"
            fi ;;
        "pac")
            if [ $mode == "ğŸŒ•window" ]; then
                $BROWSER "-new-window" "https://archlinux.org/packages/?sort=&q=$word&maintainer=&flagged="
            else
                $BROWSER "-new-tab" "https://archlinux.org/packages/?sort=&q=$word&maintainer=&flagged="
            fi ;;
        "aur")
            if [ $mode == "ğŸŒ•window" ]; then
                $BROWSER "-new-window" "https://aur.archlinux.org/packages?O=0&K=$word"
            else
                $BROWSER "-new-tab" "https://aur.archlinux.org/packages?O=0&K=$word"
            fi ;;
        "wk")
            if [ $mode == "ğŸŒ•window" ]; then
                $BROWSER "-new-window" "https://en.wikipedia.org/wiki/$word"
            else
                $BROWSER "-new-tab" "https://en.wikipedia.org/wiki/$word"
            fi ;;
    esac
elif [ "$Choice" == "ğŸ”§toolBar" ]; then
    get_BookMark "$HOME/.local/share/BookMark/ToolBar"
elif [ "$Choice" == "ğŸ“’readingList" ]; then
    get_BookMark "$HOME/.local/share/BookMark/ReadingList"
elif [ "$Choice" == "ğŸƒntuBookMark" ]; then
    file=$(echo -e "ğŸ“˜JuniroFirst\nğŸ”–JuniroSecond\nğŸ“šSeniorFirst" | rofi -dmenu -p "BookMark ğŸ“¡:")
    file=${file: 1}
    get_BookMark "$HOME/.local/share/BookMark/NTUBookMark/$file"
elif [ "$Choice" == "ğŸpythonResources" ]; then
    get_BookMark "$HOME/.local/share/BookMark/python"
elif [ "$Choice" == "ğŸ«juliaResources" ]; then
    get_BookMark "$HOME/.local/share/BookMark/julia"
elif [ "$Choice" == "ğŸ“‰econData" ]; then
    get_BookMark "$HOME/.local/share/BookMark/EconData"
fi
